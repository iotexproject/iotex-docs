(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{628:function(e,t,a){"use strict";a.r(t);var i=a(38),o=Object(i.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"send-data-to-aws-iot-core"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#send-data-to-aws-iot-core"}},[e._v("#")]),e._v(" Send data to AWS IoT Core")]),e._v(" "),a("p",[e._v("This document describes the process for connecting Pebble with the AWS IoT Core and validating that the connection has been established successfully. You need to "),a("a",{attrs:{href:"pebble-aws-configuration"}},[e._v("configure an AWS IoT Policy and a "),a("em",[e._v("Thing")])]),e._v(", make sure you downloaded the AWS cryptographic certificates for that "),a("em",[e._v("Thing")]),e._v(" when you created it on AWS, and take note of the AWS IoT device data endpoint (you can find the endpoint in the AWS IoT console on the "),a("em",[e._v("Thing")]),e._v("'s details page, it should look similar to "),a("code",[e._v("a3qjEXAMPLEffp-ats.iot.us-west-2.amazonaws.com")]),e._v(").")]),e._v(" "),a("p",[a("img",{attrs:{src:"/img/developer/pebble-certificates.png",alt:""}})]),e._v(" "),a("h2",{attrs:{id:"update-the-cerdentials-in-the-firmware"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#update-the-cerdentials-in-the-firmware"}},[e._v("#")]),e._v(" Update the Cerdentials in the Firmware")]),e._v(" "),a("p",[e._v("In order for Pebble to send data to AWS we need to update the firmware to use the certificates we downloaded from AWS for our "),a("em",[e._v("Thing")]),e._v(": see the "),a("a",{attrs:{href:"pebble-build-windows"}},[e._v("Develop and Build the Firmware")]),e._v(" to learn how to configure your system to build and flash the Pebble firmware.")]),e._v(" "),a("p",[e._v("Edit the firmware source file "),a("code",[e._v("certificate.h")]),e._v(" located at 'nrf\\applications\\asset"),a("em",[e._v("tracker\\src\\certificates.h', and replace the content for the macros 'NRF_CLOUD_CLIENT_PRIVATE_KEY', 'NRF_CLOUD_CLIENT_PUBLIC_CERTIFICATE', and 'NRF_CLOUD_CA_CERTIFICATE' with the AWS _Thing")]),e._v(" private key (i.e., xxx-private.pem.key), public certificate (i.e., xxx-certificate.pem.crt), and the AWS Root certificate (i.e., AmazonRootCA1.pem), respetively.")]),e._v(" "),a("p",[a("img",{attrs:{src:"/img/developer/pebble_certificate_string.png",alt:""}})]),e._v(" "),a("p",[e._v("Make sure that you edited the macros correctly (see the image) adding a new line character "),a("code",[e._v("\\n")]),e._v("at the end of each line, without modifying, adding or deleting any character of the certificates.")]),e._v(" "),a("h2",{attrs:{id:"configure-the-firmware-to-use-the-aws-certificate"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configure-the-firmware-to-use-the-aws-certificate"}},[e._v("#")]),e._v(" Configure the firmware to use the AWS certificate")]),e._v(" "),a("p",[e._v("To instruct the firmware to actually transfer the new certificates provided in "),a("code",[e._v("certificate.h")]),e._v(" into the modem, in the firmware configuration locate the "),a("code",[e._v("Asset Tracker -> Use provisioned certificates")]),e._v(" item and "),a("strong",[e._v("uncheck")]),e._v(" it, then locate the "),a("code",[e._v("Zephyr Kernel -> Modules -> Nordin nRF Connect -> Libraries -> nRF9160 modem key management library")]),e._v(" and "),a("strong",[e._v("enable it")])]),e._v(" "),a("p",[e._v("Check out "),a("a",{attrs:{href:"pebble-firmware-configure"}},[e._v("how to configure the firmware")]),e._v(" for instructions on how to start the firmware configuration. You can use the search functionality to quickly locate the setting you are loking for.")]),e._v(" "),a("h2",{attrs:{id:"configure-the-aws-endpoint-in-pebble"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configure-the-aws-endpoint-in-pebble"}},[e._v("#")]),e._v(" Configure the AWS endpoint in Pebble")]),e._v(" "),a("p",[e._v("There is one last step to make before we can finally build the new firmware: set the endpoint of our AWS "),a("em",[e._v("Thing")]),e._v(" where the Pebble should send the data to. In the firmware configuration locate the "),a("code",[e._v("Asset Tracker -> MQTT_BROKER_HOSTNAME")]),e._v(" item and set it to your AWS "),a("em",[e._v("Thing")]),e._v(" endpoint and save the configuration, then locate the "),a("code",[e._v("Asset Tracker -> MQTT_BROKER_PORT")]),e._v(" and set it to "),a("code",[e._v("8883")]),e._v(".")]),e._v(" "),a("p",[e._v("Check out "),a("a",{attrs:{href:"pebble-firmware-configure"}},[e._v("how to configure the firmware")]),e._v(" for instructions on how to start the firmware configuration")]),e._v(" "),a("h2",{attrs:{id:"build-and-flash-the-modified-firmware"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#build-and-flash-the-modified-firmware"}},[e._v("#")]),e._v(" Build and flash the modified firmware")]),e._v(" "),a("p",[e._v("Finally, you can "),a("a",{attrs:{href:"pebble-build-windows"}},[e._v("Compile the firmware")]),e._v(" and "),a("a",{attrs:{href:"pebble-flash"}},[e._v("flash it")]),e._v(" into the Pebble.")]),e._v(" "),a("h2",{attrs:{id:"validate-the-connection-in-aws-iot"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#validate-the-connection-in-aws-iot"}},[e._v("#")]),e._v(" Validate the connection in AWS IoT")]),e._v(" "),a("p",[e._v("In your AWS IoT console choose "),a("strong",[e._v("test")]),e._v(" in left menu and specify the "),a("strong",[e._v("Subscription topic")]),e._v(" to be "),a("code",[e._v("device/nrf-XXXXXXXXXXXXXXX/data")]),e._v(", where "),a("code",[e._v("XXXXXXXXXXXXXXX")]),e._v(" is the unique 15-digit IMEI number of your Pebble modem (you can find this number printed on a lable included in your Pebble box, also it's reported on the device serial port log output).")]),e._v(" "),a("p",[a("img",{attrs:{src:"/img/developer/pebble_aws_iot_test.png",alt:""}})]),e._v(" "),a("p",[e._v("If the connection between Pebble and AWS has been estabilished correctly, after clicking the "),a("strong",[e._v("Subscribe to topic")]),e._v(" button you will see the json messages incoming (by default, one every 30s) into the AWS test console.")])])}),[],!1,null,null,null);t.default=o.exports}}]);