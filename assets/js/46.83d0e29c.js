(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{631:function(e,t,a){"use strict";a.r(t);var s=a(38),n=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h2",{attrs:{id:"configure-the-api-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configure-the-api-server"}},[e._v("#")]),e._v(" Configure the Api server")]),e._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[e._v("WARNING")]),e._v(" "),a("p",[e._v("This document is not updated.")])]),e._v(" "),a("p",[e._v("The Api server is a REST API proxy for converting incoming REST API requests into valid smart contract calls that are broadcast tho the IoTeX Blockchain through gRPC calls.")]),e._v(" "),a("p",[e._v("The Api server receives requests from a Thingsboard rule chain previously "),a("a",{attrs:{href:"pebble-blockchain-tbrule"}},[e._v("configured to send telemetry data over REST API calls")]),e._v(" that look like the one below:")]),e._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[e._v("HTTP "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1.1")]),e._v(" POST /api/v1/topic/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("topic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("/data\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// ...")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// body is the json object containing device telemetry data")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br")])]),a("p",[e._v("The API server will process the received requests, generate and sign a IoTeX Smart Contract Call action that is then sent to a Blockchain endpoint to be broadcast to the IoTeX network.\nThe data will then be processed by the contract to execute further operations on chain.")]),e._v(" "),a("h2",{attrs:{id:"setup-an-api-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#setup-an-api-server"}},[e._v("#")]),e._v(" Setup an API Server")]),e._v(" "),a("p",[e._v("Since the API server is the tool responsible for building and signing blockchain transactions and send the data so a smart contract, you should deploy your own server and configure it with your blockchain credentials.")]),e._v(" "),a("h3",{attrs:{id:"clone-and-build-the-api-server-code"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#clone-and-build-the-api-server-code"}},[e._v("#")]),e._v(" Clone and build the Api server code")]),e._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" clone https://github.com/iotexproject/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v(".\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v(".\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("make")]),e._v(" build\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br")])]),a("h3",{attrs:{id:"create-a-blockchain-account"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#create-a-blockchain-account"}},[e._v("#")]),e._v(" Create a blockchain account")]),e._v(" "),a("p",[e._v("You need a IoTeX blockchain account for the Api server to sign blockchain transactions and send the telemetry data to a Smart Contract. You can create a new account using "),a("a",{attrs:{href:"iopay.iotex.io"}},[e._v("ioPay Wallet")]),e._v(" or "),a("a",{attrs:{href:""}},[e._v("ioctl")]),e._v(" command line client. Eventually, you will need to generate and save the keystore file for this account into the Api server folder.")]),e._v(" "),a("h3",{attrs:{id:"edit-the-api-server-configuration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#edit-the-api-server-configuration"}},[e._v("#")]),e._v(" Edit the Api server configuration")]),e._v(" "),a("p",[e._v("Create a "),a("code",[e._v(".env")]),e._v(" file to hold the configuration for the Api server, containing the settings below:")]),e._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# put a IoTeX endpoint here - e.g api.iotex.one:443")]),e._v('\nIO_ENDPOINT=""\n'),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# The address of the smart contract to send the data to")]),e._v('\nCONTRACT_ADDRESS=""\n'),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# The address of the account that will be used to sign contract tx")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# i.e. the one that you just created and exported in keystore")]),e._v('\nVAULT_ADDRESS="io12nkclkys0awtax28dsj45tzr3a6u4w4ev2gccu"\n'),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# The password of the keystore file")]),e._v('\nVAULT_PASSWORD="strong password here"\n'),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Gas price for the contract transactions in [Qev] units - e.g. 1")]),e._v("\nGAS_PRICE=1\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Gas price for the contract transactions in [Qev] units - e.g. 200000")]),e._v("\nGAS_LIMIT=200000\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Blockchain Polling interval")]),e._v("\nSLEEP_INTERVAL=<Waiting time for obtaining contract execution result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br")])]),a("h3",{attrs:{id:"set-the-api-server-url-in-thingsboard"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#set-the-api-server-url-in-thingsboard"}},[e._v("#")]),e._v(" Set the Api server url in Thingsboard")]),e._v(" "),a("p",[e._v("Into your Pebble Backend, login to Thingsboard and edit the "),a("a",{attrs:{href:"pebble-blockchain-tbrule"}},[e._v("Rule Chain")]),e._v(" so that the REST API Call will point to the Api server")]),e._v(" "),a("h3",{attrs:{id:"run-the-api-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#run-the-api-server"}},[e._v("#")]),e._v(" Run the Api server")]),e._v(" "),a("p",[e._v("Launch the Api server with the following command:")]),e._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[e._v("./bin/pebble-data-container\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])])])}),[],!1,null,null,null);t.default=n.exports}}]);